<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reset Password - ApnaGarage</title>
  <link rel="stylesheet" href="../css/resetPasswordEmail.css" />
  <link rel="stylesheet" href="../css/navbar.css" />
</head>

<body>
  <!-- Navbar -->
  <div class="navbar">
    <div class="nav-left">
      <h1>APNA GARAGE</h1>
    </div>
    <div class="nav-right">
      <button class="nav-button" onclick="redirectToLogin()">RETURN</button>
    </div>
  </div>

  <!-- Reset Password Form -->
  <div class="form-container">
    <h2>Please Enter Email for Reset Link</h2>
    <form id="resetPasswordForm">
      <label for="email">Email:</label>
      <input type="email" id="email" name="email" placeholder="Enter your registered email" required />

      <!-- <label for="newPassword">New Password:</label>
        <input
          type="password"
          id="newPassword"
          name="newPassword"
          placeholder="Enter your new password"
          required
        />

        <label for="confirmPassword">Confirm New Password:</label>
        <input
          type="password"
          id="confirmPassword"
          name="confirmPassword"
          placeholder="Confirm your new password"
          required
        /> -->

      <button type="submit" class="submit-button">Get Link</button>
    </form>
  </div>

  <script>// Redirect to login page
    function redirectToLogin() {
      window.location.href = '../pages/login.html';
    }

    // Reset Password Logic
    const resetPasswordForm = document.getElementById('resetPasswordForm');
    // console.log(resetPasswordForm);
    resetPasswordForm.addEventListener('submit', async function (e) {
      console.log('hello');
      e.preventDefault(); // Prevent form submission

      const email = document.getElementById('email').value;
      console.log(email);
      if (email === '') {
        alert('email is required');
        e.preventDefault();
      }

      //   const requestData = {
      //     content: description,
      //     service_id: serviceType,
      //     location,
      //     startTime: null,
      //     completed: false,
      //   };
      try {
        const response = await fetch(
          `http://127.0.0.1:5500/api/v1/users/resetPasswords/${email}`,
          {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json',
            },
            credentials: 'include',
            // body: JSON.stringify(requestData),
          }
        );
        const result = await response.json();
        if (response.ok) {
          if (confirm('Reset Link has been sent to your email address.')) {
            window.location.href = './landingPage.html';
          }
        } else {
          alert(`Oops, Something went wrong. Try Again Later. ${result.message}`);
          console.log(`Error while trying to Reset password: ${result.message}`);
        }
      } catch (error) {
        alert(`Oops, Something went wrong. Try Again Later. ${result.message}`);
        console.log(`Error while trying to reset password: ${result.message}`);
      }
    });
  </script>
</body>

</html>